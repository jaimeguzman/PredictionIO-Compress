# PredictionIO-LZModel



## Overview
This engine let you explore some behaviour of the well know it Lempel Ziv algorithm family. Is used to predict from sequences of access. I try to make a hybrid model between Machine Learning and Lossless Data Compression for predict the next page that some user can access within a web; using training techniques and compression algorithm like well know LZ78, on a server Machine Learning. To this end we will work to create and study a predictive model that uses both areas and provide the results of the predictive model with integrated online component to any type of platform. This Engine Template is still in development, we have based or implementation on Decission Tree Template from templates.prediction.io

The default use case of this Engine Template is to predict a sequences of symbols (webaccess log) from use, also you can explore our data to make some experiment. You can customize it easily to fit your specific use case and needs for any sequential representation data.

To create your own LZModel engine for production use based on this template.

## Usage

### Event Data Requirements
By default, the template requires the following events to be collected ( we can check this at TemplateFolder/data/import_eventserver.py ):

- user $set event, which set the attributes of the user

### Input Query
- array of features values ( 3 features)
```
{"webaccess": "ABCABCAABCAAAAAC"  }
```

### Output Predicted Result
- the predicted label 
```
{"result": "A" }
```

### Dataset 
We will be using the sample data set from  data repository folder sequences. The training sample events have the following format (Generated by data/import_eventserver.py):
```
client.create_event(
      event="$set",
      entity_type="user",
      entity_id=str(count), # use the count num as user ID
      properties= {
        "attr0" : int(attr[0]),
        "attr1" : int(attr[1]),
        "attr2" : int(attr[2]),
        "plan" : int(plan)
      }
```


## Install and Run PredictionIO
First you need to [install PredictionIO 0.9.1](http://docs.prediction.io/install/) (if you haven't done it).
Let's say you have installed PredictionIO at /home/yourname/PredictionIO/. For convenience, add PredictionIO's binary command path to your PATH, i.e. /home/yourname/PredictionIO/bin
```
$ PATH=$PATH:/home/yourname/PredictionIO/bin; export PATH
```
Once you have completed the installation process, please make sure all the components (PredictionIO Event Server, Elasticsearch, and HBase) are up and running.

```
$ pio-start-all
```
For versions before 0.9.1, you need to individually get the PredictionIO Event Server, Elasticsearch, and HBase up and running.

You can check the status by running:
```
$ pio status
```
## Download Template
Clone the current repository by executing the following command in the directory where you want the code to reside:
    
```
git clone https://github.com/mohanaprasad1994/PredictionIO-MLlib-Decision-Trees-Template.git MyClassification
```
## Generate an App ID and Access Key
Let's assume you want to use this engine in an application named "MyApp1". You will need to collect some training data for machine learning modeling. You can generate an App ID and Access Key that represent "MyApp1" on the Event Server easily:
```
$ pio app new MyAppLZModel

```
You should find the following in the console output:
```
...
[INFO] [App$] Initialized Event Store for this app ID: 1.
[INFO] [App$] Created new app:
[INFO] [App$]       Name: MyAppLZModel
[INFO] [App$]         ID: 1
[INFO] [App$] Access Key: 3mZWDzci2D5YsqAnqNnXH9SB6Rg3dsTBs8iHkK6X2i54IQsIZI1eEeQQyMfs7b3F
```
Take note of the Access Key and App ID. You will need the Access Key to refer to "MyApp1" when you collect data. At the same time, you will use App ID to refer to "MyApp1" in engine code.

$ pio app list will return a list of names and IDs of apps created in the Event Server.

```
$ pio app list
[INFO] [App$]                 Name |   ID |                                                       Access Key | Allowed Event(s)
[INFO] [App$]               MyAppLZModel |    1 | 3mZWDzci2D5YsqAnqNnXH9SB6Rg3dsTBs8iHkK6X2i54IQsIZI1eEeQQyMfs7b3F | (all)
[INFO] [App$]               MyAppLZModel2 |    2 | io5lz6Eg4m3Xe4JZTBFE13GMAf1dhFl6ZteuJfrO84XpdOz9wRCrDU44EUaYuXq5 | (all)
[INFO] [App$] Finished listing 2 app(s).
```

## Collecting Data

A Python import script import_eventserver.py is provided in the template to import the data to Event Server using Python SDK.
Replace the value of access_key parameter by your Access Key and run:
```python
$ cd PredictionIO-LZModel
$ python data/import_eventserver.py --access_key 3mZWDzci2D5YsqAnqNnXH9SB6Rg3dsTBs8iHkK6X2i54IQsIZI1eEeQQyMfs7b3F
```
You should see the following output:
```
Importing data...
6 events are imported.
```
This python script converts the data file to proper events formats as needed by the event server.
Now the training data is stored as events inside the Event Store.

## Deploy the Engine as a Service
Now you can build, train, and deploy the engine. First, make sure you are under the PredictionIO-LZModel directory.

### Engine.json

Under the directory, you should find an engine.json file; this is where you specify parameters for the engine.
Make sure the appId defined in the file match your App ID.




### Build

Start with building your engine.
```
$ pio build
```
This command should take few minutes for the first time; all subsequent builds should be less than a minute. You can also run it with --verbose to see all log messages.

Upon successful build, you should see a console message similar to the following.
```
[INFO] [Console$] Your engine is ready for training.
```

### Training the Predictive Model

Train your engine.

```
$ pio train
```
When your engine is trained successfully, you should see a console message similar to the following.

```
[INFO] [CoreWorkflow$] Training completed successfully.
```
### Deploying the Engine

Now your engine is ready to deploy.

```
$ pio deploy
```
This will deploy an engine that binds to http://localhost:8000. You can visit that page in your web browser to check its status.




## Use the Engine

Now, You can try to retrieve predicted results. For example, to predict the label (i.e. plan in this case) of a user with some session (webaccess log)  AABBAABA, you send this JSON { "webaccess": "AA", mum="10" } to the deployed engine and it will return a JSON of the predicted plan. Simply send a query by making a HTTP request or through the EngineClient of an SDK:

> page query
```python
import predictionio
engine_client = predictionio.EngineClient(url="http://localhost:8000")
print engine_client.send_query({"webaccess": "A", "num": 10})
```

> Sequences query
```python
"""
Send sample query to prediction engine
"""
import predictionio
import readline
engine_client = predictionio.EngineClient(url="http://localhost:8000")
while True:
    word = raw_input('Enter a Sequences or a single page to predict the next user webaccess: \t')
    print engine_client.send_query({"webaccess": word, "num": 10})G
```



The sample quesry can be found in **test.py** and the second script in **send_query.py** 



